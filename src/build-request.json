{
  "kind": "build_request",
  "title": "Fix persistent PDF display issue in approved applications",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Investigate and diagnose why PDF attachments in approved application statuses are not displaying correctly despite previous attempts to fix the issue in versions 39-40",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "version 40 is live but still my problem is same"
        ]
      },
      "acceptanceCriteria": [
        "Root cause of PDF display failure is identified",
        "Clear understanding of whether the issue is in backend data storage, frontend rendering, or blob URL generation"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Ensure that when an application status is approved, the PDF attachment bytes stored in the backend are valid and complete PDF data",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "PDF bytes stored in backend pass validation checks (PDF header and EOF markers present)",
        "Backend logs or returns diagnostic information about PDF data integrity when storing attachments"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Fix the PdfAttachmentSection component to reliably display approved application PDFs by ensuring blob URLs are correctly generated from valid PDF bytes and iframes can render them",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "PDF preview iframe displays the complete PDF content when application status is approved",
        "Console logs show successful blob URL creation and no PDF validation errors",
        "View and download buttons work correctly for approved application PDFs"
      ]
    },
    {
      "id": "REQ-4",
      "text": "Add comprehensive error logging to track the complete PDF data flow from backend retrieval through blob URL creation to iframe rendering, including validation results at each step",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "Console logs show PDF byte array length when received from backend",
        "Console logs show PDF validation results (header check, EOF marker check)",
        "Console logs show blob URL creation success/failure",
        "Console logs show iframe load events and any rendering errors"
      ]
    }
  ],
  "constraints": [
    "Do not modify the existing backend schema for ApplicationStatus",
    "Preserve the current PDF validation logic in pdfAttachment.ts utility",
    "Maintain compatibility with existing approved application records"
  ],
  "nonGoals": [
    "Redesigning the application status approval workflow",
    "Adding new PDF processing features beyond fixing the display issue",
    "Changing the authentication or routing system"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}